---
- name: Install apt-transport-https
  become: true
  apt:
    name: apt-transport-https
    state: present
  tags:
    - config-tool
    - config-gcp

- name: Install ca-certificates
  become: true
  apt:
    name: ca-certificates
    state: present
  tags:
    - config-tool
    - config-gcp

- name: Install gnupg
  become: true
  apt:
    name: gnupg
    state: present
  tags:
    - config-tool
    - config-gcp

- name: setup google-cloud-cli repo
  become: true
  shell: |
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
    apt update
  tags:
    - config-tool
    - config-gcp

- name: Install google-cloud-cli
  become: true
  apt:
    name: google-cloud-cli
    state: present
  when: not ansible_check_mode
  tags:
    - config-tool
    - config-gcp

- name: Install google-cloud-cli-terraform-validator
  become: true
  apt:
    name: google-cloud-cli-terraform-validator
    state: present
  when: not ansible_check_mode
  tags:
    - config-tool
    - config-gcp
