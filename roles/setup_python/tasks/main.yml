- name: Install Dependencies
  apt:
    name: '{{ APT_PACKAGES }}'
    state: present
  when: "ansible_os_family == 'Debian'"

- name: Ensure pyenv installed
  shell: bash -l -c 'which pyenv'
  changed_when: false

- name: Check installed python version
  shell: bash -l -c 'pyenv versions'
  register: PYENV_INSTALLED
  changed_when: false
  ignore_errors: yes

- name: Install python from pyenv
  shell: bash -l -c 'pyenv install {{ item }}'
  when: 'item not in PYENV_INSTALLED.stdout'
  with_items: '{{ PYTHON_VERSIONS }}'

- name: Place python ver manage script
  template:
    src: files/manage_python_ver.sh
    dest: ~/.bash.d/manage_python_ver.sh
    mode: 755
