---
- name: Place yarn.sh
  template:
    src: files/yarn.sh
    dest: "$HOME/.bash.d/yarn.sh"
    mode: 0755
  tags:
    - config-language
    - config-nodejs

- name: Check installed nodejs version
  shell: bash -lc "nodenv versions"
  register: NODENV_INSTALLED
  changed_when: false
  ignore_errors: yes
  tags:
    - config-language
    - config-nodejs

- name: Install nodejs from nodenv
  shell: |
    $HOME/.anyenv/envs/nodenv/plugins/node-build/install.sh
    bash -lc "nodenv install {{ item }}"
  with_items: "{{ NODE_VERSIONS }}"
  when: 'item not in NODENV_INSTALLED.stdout'
  tags:
    - config-language
    - config-nodejs

- name: Install commitizen
  npm:
    name: "{{ item }}"
    global: yes
    state: present
  with_items:
    - commitizen
    - git-cz
  tags:
    - config-language
    - config-nodejs

- name: Set Global version
  shell: bash -lc "nodenv global {{ GLOBAL_NODE_VERSION }}"
  tags:
    - config-language
    - config-nodejs
