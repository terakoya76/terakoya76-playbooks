---
- name: Install anyenv
  git:
    repo: https://github.com/riywo/anyenv
    dest: "$HOME/.anyenv"
  tags:
    - config-base

- name: Install anyenv-update
  git:
    repo: https://github.com/znz/anyenv-update
    dest: "$HOME/.anyenv/plugins/anyenv-update"
  tags:
    - config-base

- name: Place Files
  template:
    src: files/{{ item }}
    dest: "$HOME/.bash.d/{{ item }}"
    mode: 0755
  with_items:
    - anyenv.sh
  tags:
    - config-base

- name: Init anyenv
  shell: bash -lc "anyenv install --init"
  environment:
    ANYENV_ROOT: "$HOME/.anyenv"
  ignore_errors: yes
  tags:
    - config-base

- name: Check env installed
  shell: bash -lc "anyenv envs"
  register: anyenv_envs
  changed_when: false
  tags:
    - config-base

- name: Install env tools
  shell: bash -lc "anyenv install {{ item }}"
  with_items:
    - goenv
    - nodenv
    - rbenv
    - tfenv
  environment:
    ANYENV_ROOT: "$HOME/.anyenv"
  when: 'item not in anyenv_envs.stdout'
  ignore_errors: yes
  tags:
    - config-base

- name: Update exists tools
  shell: bash -lc "anyenv update"
  environment:
    ANYENV_ROOT: "$HOME/.anyenv"
  ignore_errors: yes
  tags:
    - config-base
