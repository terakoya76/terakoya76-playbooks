---
- name: Place go-bin.sh
  template:
    src: files/go-bin.sh
    dest: "$HOME/.bash.d/go-bin.sh"
    mode: 0755
  tags:
    - config-language
    - config-go

- name: Check installed golang version
  shell: bash -lc "goenv versions"
  register: GOENV_INSTALLED
  changed_when: false
  ignore_errors: yes
  tags:
    - config-language
    - config-go

- name: Install golang from goenv
  shell: bash -lc "goenv install {{ item }}"
  with_items: "{{ GO_VERSIONS }}"
  environment:
    GOENV_DISABLE_GOPATH: "1"
  when: 'item not in GOENV_INSTALLED.stdout'
  tags:
    - config-language
    - config-go

- name: Set Global version
  shell: bash -lc "goenv global {{ GLOBAL_GO_VERSION }}"
  environment:
    GOENV_DISABLE_GOPATH: "1"
  tags:
    - config-language
    - config-go

- name: Install golang libraries
  shell: bash -lc "GOPATH=$(echo $HOME)/go go install {{ item }}"
  with_items: "{{ GO_BINARIES }}"
  environment:
    GOENV_DISABLE_GOPATH: "1"
  ignore_errors: yes
  tags:
    - config-language
    - config-go
